<div ng-include="'views/header.html'"
     onload="header_title='Your Preferences'; header_subtitle='Receiver Interface'">
</div>

<div class="container config-page">
  <div class="row">

    <div class="span3 config-sidebar"
         ng-include="'views/receiver/sidebar.html'" ng-controller="ReceiverSidebarCtrl">
    </div>

    <div class="span9">

      <div class="row">
        <form class="config-form">
            <div class="span4">

            <h4>{{ "Preferences and password management" | translate }}</h4>
            <br>

            <p>{{ "Your username" | translate }}: {{preferences.username}}</p>

            <label><b>{{ "Current Password" | translate }}</b></label>
            <input type="password"
            ng-model="preferences.old_password">
            <p class="text-error" ng-show="missing_old_password">{{ "Required old password confirm" | translate }}</p>

            <label><b>{{ "New Password" | translate }}</b></label>
            <input type="password"
            ng-model="preferences.password" >
            <p class="text-error" ng-show="unsafe_password">{{ "Your password is unsafe, it should have" | translate }}:</p>
            <li class="text-error" ng-hide="pwdHasLetter">{{ "At least one letter" | translate }}</li>
            <li class="text-error" ng-hide="pwdHasNumber">{{ "At least one number" | translate }}</li>
            <li class="text-error" ng-hide="pwdValidLength">{{ "At least 8 keypress long" | translate }}</li>

            <label><b>{{ "Retype again your new password" | translate }}</b></label>
            <input type="password"
            ng-model="preferences.check_password">
            <p class="text-error" ng-show="mismatch_password">{{ "The two passwords do not match" | translate }}</p>

          </div>
        </form>
      </div>

      <div class="row">
          <div class="span4">

            <button type="submit" class="btn btn-success"
                ng-disabled="mismatch_password || unsafe_password || missing_old_password"
                ng-click="pass_save()">Change password</button>

        </div>
      </div>

      <form class="config-form">
        <div class="row">
                <div class="span4">

                    <h4>Notification settings</h4>

                    <label>
                    <input type="checkbox"
                           ng-init="copy_tip_notification = preferences.tip_notification"
                           ng-click="copy_tip_notification = !copy_tip_notification" />
                        new Tip trigger an email notification
                        </label>

                    <label>
                    <input type="checkbox"
                           ng-init="copy_comment_notification = preferences.comment_notification"
                           ng-click="copy_comment_notification = !copy_comment_notification" />
                        new Comment on a Tip, trigger an email notification
                        </label>

                    <label>
                    <input type="checkbox"
                           ng-init="copy_file_notification = preferences.file_notification"
                           ng-click="copy_file_notification = !copy_file_notification" />
                        new File uploaded on a Tip, trigger an email notification
                        </label>

                </div>
        </div>

        <div class="row">
            <div class="span8">
                <h4>Encryption settings</h4>

                <div ng-show="preferences.gpg_key_fingerprint"
                     ng-init="preferences.gpg_key_remove = false"
                     class="icon-ok">
                    You have an<b>Active Key</b><br>
                    The fingerprint is: {{preferences.gpg_key_fingerprint}}
                </div>

                <div ng-show="preferences.gpg_key_fingerprint">
                    <p>Select encryption usage</p>
                    <label ng-show="preferences.gpg_key_fingerprint">
                        <input type="checkbox" ng-model="preferences.gpg_enable_notification" />
                        Encrypt notification email.
                    </label>
                    <label ng-show="preferences.gpg_key_fingerprint">
                        <input type="checkbox" ng-model="preferences.gpg_enable_files" />
                        Encrypt files reserved for you.
                    </label>
                </div>

                <button class="btn btn-info"
                        ng-show="preferences.gpg_key_fingerprint"
                        ng-click="expose_gpg_key = !expose_gpg_key"
                        ng-init="expose_gpg_key=false">
                    see GPG key details
                </button>

                <div
                     ng-show="expose_gpg_key && preferences.gpg_key_info">
                     <pre>{{preferences.gpg_key_info}}</pre>
                </div>

                <button class="btn btn-danger"
                        ng-hide="preferences.gpg_key_fingerprint"
                        ng-click="gpg_marketing = !gpg_marketing"
                        ng-init="gpg_marketing=false">
                    You've not encryption enabled!
                </button>

                <div
                    ng-show="gpg_marketing">
                    <p><a href="https://gnupg.org">GnuPG</a>can be configured in order to deliver
                        encrypted email and store encrypted files.
                        You've to copy paste the ascii version of your personal key, and then would be
                        possibile update your encryption settings. Talk to your admin if you've doubts.
                    </p>
                </div>

                <div>
                    <label>Update or configure your GPG Key:</label>
                    <textarea ng-model="preferences.gpg_key_armor"></textarea>

                    <label ng-show="preferences.gpg_key_fingerprint">
                        <input type="checkbox"
                               ng-init="copy_gpg_key_remove = preferences.gpg_key_remove"
                               ng-click="copy_gpg_key_remove = !copy_gpg_key_remove" />
                        Remove your GPG key.
                    </label>
                    <br>
                    <button type="submit" class="btn btn-success" ng-click="pref_save()" >
                        Update notification and encryption settings
                    </button>
                </div>

            </div>
        </div>
      </form>

    </div>

  </div>

</div>


