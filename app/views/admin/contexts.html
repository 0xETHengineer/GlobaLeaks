<div ng-include="'views/header.html'"
  onload="header_title='Contexts Configuration';
  header_subtitle='Administration Interface'"
>
</div>


<div class="container config-page">

  <div class="row">
    <!-- Begin Nav Bar -->
    <!--  Note the use of "''", yeah two of them.
            This is the ng-inlcude directive:
            http://docs.angularjs.org/api/ng.directive:ngInclude
      -->
    <div class="span3 config-sidebar"
      ng-include="'views/admin/sidebar.html'">
    </div>
    <!-- End Nav Bar -->

    <div class="span9">

      <!-- ContextList -->
      <div ng-controller="AdminContextsCtrl">
        <div class="row">
          <div class="span4">
            <h4>Contexts list</h4>
          </div>
          <div class="span4">
            <h4>details</h4>
          </div>
        </div>

        <div class="row" ng-repeat="context in admin.contexts">
          <div class="span9 configRow" ng-class-even="'odd'">
            <form name="contextForm">

              <div class="row">

                <div class="span4">
                  <label>Name</label>
                  <input type="text"
                         required
                         ng-model="context.name"
                         value="{{context.name}}">

                </div>

                <div class="span4">
                  <label>Receivers</label>
                  <select multiple ui-select2 style="width: 200px"
                          ng-model="context.receivers">
                    <option
                            ng-repeat="receiver in admin.receivers"
                            value="{{receiver.receiver_gus}}">{{receiver.name}}</option>
                  </select>
                </div>
              </div>

              <div class="row">

                <div class="span4">
                  <label>Description</label>
                  <textarea
                          required
                          ng-model="context.description">{{context.description}}</textarea>
                </div>

                <div class="span4">
                  <label>Fields</label>
                  <div ng-repeat="field in context.fields" class="dl-horizontal" ng-controller="AdminFieldEditorCtrl">
                    <div class="field" ng-hide="editing" ng-click="editing=true">
                      <span>{{field.label}}</span>
                      <a href="" data-content="{{field.hint}}"
                         data-trigger="hover" bs-popover="{{field.label}}">
                        <i class="icon-question-sign"></i>
                      </a>
                      <i class="type" ng-class="{'icon-font': field.type=='text',
                                    'icon-align-left': field.type=='textarea'}"></i>
                    </div>
                    <div class="editor" ng-show="editing">

                      <div class="editorHeader field" ng-click="editing=false">
                        {{field.label}} <span>click to close</span>
                      </div>

                      <div class="row editorBody">
                        <div class="span4">
                          <label>Label</label>
                          <input type="text" ng-model="field.label">

                          <label>Name</label>
                          <input type="text" ng-model="field.name">

                          <label>Hint</label>
                          <input type="text" ng-model="field.hint">

                          <label>Type</label>
                          <select id="editFieldType" ng-model="field.type" ng-required>
                            <option value="text">Text</option>
                            <option value="radio">Radio Buttons</option>
                            <option value="select">Drop Menu (Select)</option>
                            <option value="multiple">Multi-Select</option>
                            <option value="checkboxes">Checkboxes</option>
                            <option value="textarea">Paragraph(s)</option>
                            <option value="number">Number</option>
                            <option value="url">Url</option>
                            <option value="phone">Phone</option>
                            <option value="email">Email</option>
                          </select>

                          <div ng-switch on="typeSwitch(field.type)">
                            <div ng-switch-default></div>

                            <div ng-switch-when="multiple">
                              <div ng-repeat="option in field.options">
                                <form class="form-inline">
                                  <label>Name</label>
                                  <input type="text" placeholder="name" ng-model="option.name">
                                  <label>Value</label>
                                  <input type="text" placeholder="value" ng-model="option.value">
                                </form>
                              </div>
                              <button class="btn btn-info" ng-click="addOption(field)">
                                <i class="icon-plus-sign"></i> add option
                              </button>
                            </div>

                          </div>

                        </div>
                      </div>
                    </div>
                  </div>



                  <button class="btn btn-success saveContext"
                          ng-disabled="contextForm.$pristine || contextForm.$invalid"
                          ng-click="update(context)">Save</button>

                  <button class="btn btn-danger deleteContext"
                          ng-click="delete(context)">Delete</button>

                </div>

              </div>

            </form>
          </div>
        </div>

        <div class="row">
          <div class="span9 configRow addContext">
            <h4>Add new context</h4>
            <form name="newContext">
              <div class="row">
                <div class="span4">
                  <input type="text" ng-model="new_context_name" required>
                </div>
              </div>
              <div class="row">
                <div class="span4">
                  <button class="btn" ng-disabled="newContext.$invalid"
                          ng-click="admin.create_context(new_context_name)">add</button>
                </div>
              </div>
            </form>
          </div>
        </div>

      </div>
      <!-- End Context List -->

    </div>
  </div>
</div>


