<div ng-include="'views/header.html'"
  onload='header_title="Content Settings" | translate;
  header_subtitle="Administration Interface" | translate'>
</div>

<div class="container config-page">
  <div class="row">
    <!-- Begin Nav Bar -->
    <!--  Note the use of "''", yeah two of them.
            This is the ng-inlcude directive:
            http://docs.angularjs.org/api/ng.directive:ngInclude
      -->
    <div class="span3 config-sidebar"
      ng-include="'views/admin/sidebar.html'">
    </div>
    <!-- End Nav Bar -->
    <div class="span9">

      <h3>
        {{ "General information" | translate }}
      </h3>
      <p><b>{{ "You're running GlobaLeaks version" | translate }} {{admin.node.version}}</b></p>

      <label>{{ "Current initiative logo" | translate }}</label>
      <form name="contentForm" novalidate>
        <div class="imageUpload" ng-controller="ImageUploadCtrl">
          <div class="profile" ng-mouseenter="openUploader()"
               ng-mouseleave="closeUploader()">

            <div ng-show="uploadfile || fileSelected" class="uploadfile">

              <div pragmatic-file-upload ng-src="'/admin/staticfiles?globaleaks_logo'">

                <button class="close" ng-click="closeProfile()">Ã—</button>
                <div class="fileselector">
                  <input type="file" class="file"
                         name="profile">
                  <button class="btn selectFile">
                    {{ "Select file" | translate }}</button>
                </div>
                <button class="btn upload" ng-disabled="!fileSelected"
                        ng-class="{'btn-success': fileSelected}">
                        {{ "upload" | translate }}</button>

              </div>
            </div>

            <img ng-src="/static/globaleaks_logo.png" class="img-polaroid baseimage">

          </div>
        </div>

        <div class="row">
          <div class="span9">
            <label>{{ "Node name" | translate }}</label>
            <input type="text" ng-model="admin.node.name" value="{{admin.node.name}}">
          </div>
        </div>

        <!-- Description -->
        <div class="row">
          <div class="span9">
            <label>{{ "Description" | translate }}</label>
            <textarea ng-model="admin.node.description[selected_language]">{{admin.node.description[selected_language]}}</textarea>
          </div>
        </div>

        <div class="row">
          <div class="span9">
            <label>{{ "Email" | translate }}</label>
            <input type="email" ng-model="admin.node.email">
          </div>
        </div>

        <div class="row">
          <div class="span9">
            <label>{{ "Enabled languages" | translate }}</label>
            <div ng-repeat="language in admin.node.languages_supported">
              <label><input type="checkbox" ng-model="enabled_languages[language.code]"> {{language.name}}</label>
            </div>
          </div>

        </div>

        <label>{{ "Tor Hidden Service (hostname)" | translate }}</label>
        <input type="text" name="hidden_service" ng-model="admin.node.hidden_service"
               ng-pattern="/^http://[0-9a-z]{16}\.onion$/">
        <p class="text-error" ng-show="contentForm.hidden_service.$error.pattern">
        {{ "Invalid format for hidden service (should be http://thirteenchars123.onion)" | translate }}</p>

        <label>{{ "Tor2web Public Site (url)" | translate }}</label>
        <input type="url" name="public_site" ng-model="admin.node.public_site"
               ng-pattern="/^https://[0-9a-z.:]*$/">
        <p class="text-error" ng-show="contentForm.public_site.$error.pattern">
        {{ "Invalid format for public site (should be https://thirteenchars123.tor2web.org)" | translate }}</p>

        <!-- <div ng-include="'views/admin/content/internationalization.html'"> -->

        <br>
        <a ng-click="tor2web_editing = !tor2web_editing" ng-init="tor2web_editing = false" ng-show="!tor2web_editing">
            {{ "Edit Tor2Web accessibility table " | translate }}
        </a>
        <a ng-click="tor2web_editing = !tor2web_editing" ng-show="tor2web_editing">
            {{ "Edit Tor2Web accessibility table - [click again to close]" | translate }}
        </a>

        <div ng-show="tor2web_editing">
            <div class="table-bordered">
              <label>
                  <input type="checkbox" ng-model="admin.node.tor2web_admin"
                         ng-true-value="true" ng-false-value="false" />
                  {{ "Permit Administative login via Tor2Web" | translate }}
              </label>
              <label ng-show="admin.node.tor2web_admin" >
                  <span class="btn-info">
                    {{ "now Enabled:" | translate }}</span>
                  {{ "Admin can access via Tor2Web. This is safe only if you're using a dedicated Tor2Web server." | translate }}
              </label>
            </div>

            <div class="table-bordered" >
              <label>
                  <input type="checkbox" ng-model="admin.node.tor2web_receiver"
                         ng-true-value="true" ng-false-value="false" />
                  {{ "Permit Receiver preferences management via Tor2Web" | translate }}
              </label>
              <label ng-show="admin.node.tor2web_receiver" >
                  <span class="btn-info">
                    {{ "now Enabled:" | translate }}</span>
                  {{ "Receivers can access via Tor2Web. This is dangerous and it's recommended instead to train receivers in the use of Tor and Enigmail." | translate }}
              </label>
            </div>

            <div class="table-bordered" >
              <label>
                  <input type="checkbox" ng-model="admin.node.tor2web_tip"
                         ng-true-value="true" ng-false-value="false" />
                  {{ "Permit Tip access, file download and upload via Tor2Web" | translate }}
              </label>
              <label ng-show="admin.node.tor2web_tip" >
                  <span class="btn-info">
                    {{ "now Enabled:" | translate }}</span>
                  {{ "Tip can be accessed via Tor2Web by whistleblowers and receiver." | translate }}
              </label>
            </div>

            <div class="table-bordered" >
              <label>
                  <input type="checkbox" ng-model="admin.node.tor2web_unauth"
                         ng-true-value="true" ng-false-value="false" />
                  {{ "Permit access of public resources via Tor2Web" | translate }}
              </label>
              <label ng-show="admin.node.tor2web_unauth" >
                  <span class="btn-info">
                    {{ "now Enabled:" | translate }}</span>
                  {{ "Public GlobaLeaks resources can be accessed via Tor2Web. This is safe to do." | translate }}
              </label>
            </div>

            <div class="table-bordered" >
              <label>
                  <input type="checkbox" ng-model="admin.node.tor2web_submission"
                         ng-true-value="true" ng-false-value="false" />
                  {{ "Permit Submissions via Tor2Web" | translate }}
              </label>
              <label ng-show="admin.node.tor2web_submission" >
                  <span class="btn-info">
                    {{ "now Enabled:" | translate }}</span>
                  {{ "Whistleblowers can perform submission with no anonymity via Tor2Web." | translate }}
              </label>
            </div>
        </div>

        <br>
        <button class="btn btn-success" ng-hide="tor2web_editing"
                ng-disabled="contentForm.$invalid "
                ng-click="updateNode(admin.node)">
                {{ "Update node" | translate }}</button>
        <button class="btn btn-success" ng-show="tor2web_editing"
                ng-disabled="contentForm.$invalid "
                ng-click="updateNode(admin.node)">
                {{ "Update node and Tor2Web options" | translate }}</button>

      </form>
    </div>
  </div>
</div>

