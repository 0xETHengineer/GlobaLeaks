#!/usr/bin/env python
# -*- encoding: utf-8 -*-


import os
import sys
import random

###
# eadem mutata resurgo https://gitorious.org/gulch-ann/gulch-ann/blobs/master/src/python/pyl.py#line222
###
def colorize(txt, col):
    """

    Colorized output.

    Plataform dependent: Linux

    """

    color_dict = {
            'GREY':   0, 'RED':   1, 'GREEN':   2,
            'YELLOW': 3, 'BLUE':  4, 'MAGENTA': 5,
            'CYAN':   6, 'WHITE': 7, 'BLACK':   8
            }
    return '\033[1;3%dm%s\033[0m' %(color_dict[col], txt)


print colorize("""
MMMMMMMMM.$$$$$$$$$$$$$$$Z.DNNNNNNNNNNNNNNN .NNNNNNNNNNNNNNNZ.NNNNNNNNNNNNNNNN M
MMMMMMMM Z$ZZZZZZZZZZZZZ$..NNNNNNNNNNNNNNN7.NNNNNNNNNNNNNNNN.NNNNNNNNNNNNNNNNM.M
MMMMMMM.,Z$ZZZZZZZZZZZZZ=.NNNNNNNNNNNNNNNM.NNNNNNNNNNNNNNNN.DNNNNNNNNNNNNNNNNM.M
MMMMMM+.ZZZZZZZZZZZZZZZZ.MNNNNNNNNNNNNNNM.NNNNNNNNNNNNNNNN ,NNNNNNNNNNNNNNNNNM.M
MMMMMN.$ZZZZZZZZZZZZZZ$.NNNNNNNNNNNNNNNN.:NNNNNNNNNNNNNNM=.NNNNNNNNNNNNNNNNNNM.M
MMMMM.Z$ZZZZZ$ZZZZZZZ$.ZNNNNNNNNNNNNNNN..NNNNNNNNNNNNNNN$.NNNNNNNNNNNNNNNNNNNM.M
MMMM.IZZZZZ~.+ZZZZZZ$..MNNNNM..NNNNNNN8.NNNNNN..NNNNNNNN.MNNNNN..MNNNNNNNNNNNM.M
MMM..ZZZZZZZZZZZZZZ$I.NNNNNNNNNNNNNNNN.NNNNNNNNNNNNNNNM.8NNNNNNNNNNNNNNNNNNNNM.M
MMO.ZZZZZZZZZZZZZZZZ.MNNNNNNNNNNNNNNN.DNNNNNNNNNNNNNNN.=NNNNNNNNNNNNNNNNNNNNNM M
MM.ZZZZZZZZZZZZZZZZ.NNNNNNNNNNNNNNNN.~NNNNNNNNNNNNNNN~.NNNNNNNNNNNNNNNNNNNNNNM.M
M.$$$$Z$ZZZZZZZZZ$.,NNNNNNNNNNNNNNN= NNNNNNNNNNNNNNN8.NNNNNNNNNNNNNNNNNNNNNNNM M
   .. Z$ZZZZZZZZZ......,NNNNNNNNNN$......NNNNNNNNNNM......NNNNNNNNNNNNNNNNNNNM M
MMMMM ZZZZZZZZZZZZZZZ$..NNNNNNNNNNNNNNN: +NNNNNNNNNNNNNN8.:MNNNNNNNNNNNNNNNNNM M
MMMM.?ZZZZZZZZZZZ$$=.?   :.MNNNNNNNN8.~. .$.INNNNNNNNN.,   ..:MNNNNNNNNNNNNNNM M
MMMM.$Z$ZZZZZZZZZZZ       ..NNNNNNNN  . .   .MNNNNNNN.        ?NNNNNNNNNNNNNNM M
MMM . .Z$ZZZZZZ$Z7.        .NNNNNNM.         MNNNNNN.         ?NNNNNNNNNNNNNNM M
MMM . ..ZZZZZZZZ$      .   .M:NNNN.         .N7?NNN:          ?N:MNNNNNNNNNNNM M
MM:.. ..7ZZZZZZZ$             .MNN.         ..  MNN:    .     =. =NNNNNNNNNNNM M
MM... ..$ZZZZZZZ$             7NNN.   . .     ..NNN:            .NNNNNNNNNNNNM M
M8.::~ZZZZZZZZZZ$           ..MNNN.           .NNNN:            ONNNNNNNNNNNNM M
M.$ZZZZZZZZZZZZZ$ . .     . .NNNNN.   . .     .NNNN:            NNNNNNNNNNNNNM M
M.ZZZZZZZZZZZZZZ$ . .       .NNNNN.         ..NNNNN:          .NNNNNNNNNNNNNNM M
""", random.choice(('RED', 'GREEN', 'BLUE', 'YELLOW', 'CYAN')))


header = [
    [15*" "+"/ ____| |     | |         ", "| |", 15*" "+"| |"+18*" "],
    [14*" "+"| |  __| | ___ | |__   __ _", "| |", "      ___  __ _| | _____            "],
    [14*" "+"| | |_ | |/ _ \| '_ \ / _\`", "| |", "     / _ \/ _\`| |/ / __|           "],
    [14*" "+"| |__| | | (_) | |_) | (_| ", "| |____", "|  __/ (_| |   <\__ \           "],
    [15*" "+"\_____|_|\___/|_.__/ \__,_", "|______|", "\___|\__,_|_|\_\___/           "],
]

for txt1, l, txt2 in header:
    print colorize(txt1, 'RED') + colorize(l, 'MAGENTA') + colorize(txt2, 'RED')

print '\n'
print colorize('Welcome', 'CYAN'), colorize('to', 'YELLOW'), 'Globa'+colorize('Leaks', 'RED')
print ("Please handle with extreme care."
       "Actually, you should not even be running this thing. WTF are you doing?")

# Avoid the export PYTHONPATH insanity
this_directory = os.path.dirname(__file__)
root = os.path.abspath(os.path.join(this_directory, '..'))
sys.path.insert(0, root)

backend_script = os.path.join(root, 'globaleaks', 'backend.py')

from twisted.python import log, usage
from twisted.internet import reactor
from twisted.application import app

from globaleaks import runner
from globaleaks.backend import application

import sys
sys.argv[1:] = ['-ny', backend_script]

def runApp(config):
    print "Starting GlobaLeaks"
    runner.GLBaseRunner(config).run()
    # this is a blocking operation, until app exit
    print "Exiting GlobaLeaks"

config = runner.ServerOptions()
try:
    config.parseOptions()
except usage.error, ue:
    print config
    print "%s: %s" % (sys.argv[0], ue)
else:
    runApp(config)
