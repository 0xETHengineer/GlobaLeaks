<div id="HttpsSettings" data-ng-controller="AdminHTTPSConfigCtrl">
  <div class="info-section">
    <div class="status-line">
      <h3><span data-translate>Status</span></h3>
      <span data-ng-if="tls_config.enabled">
        <span class="label label-success">
          <span data-translate>Enabled</span>
          <i class="glyphicon glyphicon-info-sign" data-ng-click="invertExpertStatus()"></i>
        </span>
        <span>&nbsp;</span>
        <span data-ng-if="tls_config.running" class="label label-success" data-translate>Running</span>
        <span data-ng-if="!tls_config.running" class="label label-warning" data-translate>Not running</span>
      </span>

      <span data-ng-if="!tls_config.enabled" class="label label-danger"><span data-translate>Disabled</span>
        <i class="glyphicon glyphicon-info-sign" data-ng-click="invertExpertStatus()"></i>
      </span>
    </div>

    <div class="hostname">
      <div data-ng-if="tls_config.enabled && tls_config.running">
        <span data-translate>URL</span><span>:</span>
        <a data-ng-show="admin.node.hostname !== ''" target="_blank" rel="noreferrer noopener" href="{{ admin.node.hostname }}">{{admin.node.hostname}}</a>
      </div>
      <div data-ng-show="admin.node.hostname === ''"
          class="alert alert-warning">
          <span data-translate>Hostname is not set!</span>
          <span><a data-ng-click="setActiveTab(0)"><span data-translate>Click here to configure it.</span></a></span>
      </div>
    </div>
  </div>
  <div data-ng-show="show_expert_status">
    <h3 data-translate >System message:</h3>
    <div class="alert alert-info"><b>{{tls_config.status.timestamp | date:'dd-MM-yyyy HH:mm' }}</b> {{ tls_config.status.msg }}</div>
  </div>
  <div data-ng-if="!tls_config.running && admin.node.hostname !== ''">
    <h3 data-translate>Configuration</h3>
    <div>
      <hr/>
      <p>
        <span data-translate>This configuration wizard will guide you through the setup of HTTPS.</span>
        <span data-translate>The interface can generate a Private Key and a Certificate Signing Request.</span>
        <span data-translate>The Certificate Signing Request can be provided to a Certificate Authority to retrieve a Certificate.</span>
        <span data-translate>After having validated your request and your ownership of the hostname the Certificate Authority will issue you a Certificate and provide a file containing Intermediate Certificates.</span>
        <span data-translate>Load the certificate and the file containing the Intermadiate Certificates to complete the HTTPS setup.</span>
        <span data-translate>Please note that the file format expected for all files uploaded is PEM.</span>
        <span data-translate>Sometimes Certificate Authorities will provide certificates in DER format which must be converted to PEM.</span>
      </p>
      <hr/>
    </div>
    <div class="panel panel-default hideable-div priv-key">
      <div data-ng-hide="!tls_config.enabled" class="disabling-div"></div>
      <div class="panel-body">
        <span data-ng-class="statusClass(tls_config.files.priv_key)">
          <span class="text-bold">1</span>
          <span class="text-bold" data-translate>Private Key</span>
          <span>(PEM)</span>
        </span>
        <span class="pull-right">
          <span class="file-upload" data-ng-if="!tls_config.files.priv_key.set">
            <label for="keyUpload" class="btn btn-xs btn-primary">
              <input id="keyUpload" type="file" file-change handler="postFile(files[0], file_resources.priv_key)"  />
              <span id='keyUploadBtn' data-translate>Upload</span>
            </label>
          </span>
          <button id="pkGen" class="btn btn-xs btn-success" data-ng-if="!tls_config.files.priv_key.set"
              data-ng-click="gen_priv_key()" data-translate>Generate</button>
          <span data-ng-if="tls_config.files.priv_key.set">
            <button class="btn btn-xs btn-danger"
                data-ng-click="deleteFile(file_resources.priv_key)" data-translate>Delete</button>
          </span>
        </span>
      </div>
    </div>

    <div data-ng-if="!tls_config.files.priv_key.set || tls_config.files.priv_key.gen" class="panel panel-default hideable-div csr">
      <div data-ng-hide="state > 0" class="disabling-div"></div>
      <div class="panel-body">
        <span data-ng-class="statusClass(tls_config.files.csr)">
          <span class="text-bold">2</span>
          <span class="text-bold" data-translate>Certificate Signing Request</span>
          <span>(PEM)</span>
        </span>
        <span data-ng-if="!tls_config.files.csr.set">
          <span class="pull-right">
            <button id="csrGen" class="btn btn-xs btn-success" data-ng-hide="csr_state.open" data-ng-click="csr_state.open = true">
              <span data-translate>Generate</span>
            </button>
            <button type="button" class="close" data-ng-show="csr_state.open" data-ng-click="csr_state.open = false" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
          </span>
          <div data-ng-show="csr_state.open">
            <hr />
            <div ng-include="'views/admin/network/csr_gen.html'"></div>
          </div>
        </span>
        <span data-ng-if="tls_config.files.csr.set">
          <span class="pull-right">
            <button id="csrDown" class="btn btn-xs btn-primary"
                data-ng-click="downloadFile(file_resources.csr)" data-translate>Download</button>
            <button class="btn btn-xs btn-danger"
                data-ng-click="deleteFile(file_resources.csr)" data-translate>Delete</button>
          </span>
      </div>
    </div>

    <div class="panel panel-default hideable-div cert">
      <div data-ng-hide="state > 1" class="disabling-div"></div>
      <div class="panel-body">
        <span data-ng-class="statusClass(tls_config.files.cert)">
          <span class="text-bold">{{!tls_config.files.priv_key.set || tls_config.files.key.gen ? '3' : '2'}}</span>
          <span class="text-bold" data-translate>Certificate</span>
          <span>(PEM)</span>
        </span>
        <span data-ng-show="tls_config.files.cert.set" class="label label-info">
          <span data-translate>Valid until:</span> {{ tls_config.files.cert.expiration_date | date:'dd-MM-yyyy HH:mm' }}
          <span data-translate>Issuer:</span> <b>{{ tls_config.files.cert.issuer }}</b>
        </span>
        <span class="pull-right">
          <span class="file-upload" data-ng-if="!tls_config.files.cert.set">
            <label for="certUpload" class="btn btn-xs btn-primary">
              <input id="certUpload" type="file" file-change handler="postFile(files[0], file_resources.cert)"  />
              <span data-translate>Upload</span>
            </label>
          </span>
          <span data-ng-if="tls_config.files.cert.set">
            <button class="btn btn-xs btn-primary"
                data-ng-click="downloadFile(file_resources.cert)" data-translate>Download</button>
            <button class="btn btn-xs btn-danger"
                data-ng-click="deleteFile(file_resources.cert)" data-translate>Delete</button>
          </span>
        </span>
      </div>
    </div>

    <div class="panel panel-default hideable-div chain">
      <div data-ng-hide="state > 2" class="disabling-div"></div>
      <div class="panel-body">
        <span data-ng-class="statusClass(tls_config.files.chain)">
          <span class="text-bold">{{!tls_config.files.priv_key.set || tls_config.files.key.gen ? '4' : '3'}}</span>
          <span class="text-bold" data-translate>Intermediate Certificates</span>
          <span>(PEM)</span>
        </span>
        <span data-ng-show="tls_config.files.chain.set" class="label label-info">
          <span data-translate>Valid until:</span>{{ tls_config.files.chain.expiration_date | date:'dd-MM-yyyy HH:mm' }}
          <span data-translate>Issuer:</span> <b>{{ tls_config.files.chain.issuer }}</b>
        </span>
        <div class="pull-right">
          <span class="file-upload" data-ng-if="!tls_config.files.chain.set">
            <label for="chainUpload" class="btn btn-xs btn-primary">
              <input id="chainUpload" type="file" file-change handler="postFile(files[0], file_resources.chain)" />
              <span data-translate>Upload</span>
            </label>
          </span>
          <span data-ng-if="tls_config.files.chain.set">
            <button class="btn btn-xs btn-primary"
                 data-ng-click="downloadFile(file_resources.chain)" data-translate>Download</button>
            <button class="btn btn-xs btn-danger"
                data-ng-click="deleteFile(file_resources.chain)" data-translate>Delete</button>
          </span>
        </div>
      </div>
    </div>

  </div>

  <div class="launch-btns" data-ng-if="state > 2">
    <button class="btn" data-ng-class="{'btn-danger': tls_config.enabled, 'btn-success': !tls_config.enabled}" data-ng-click="toggleCfg()">
      <span data-ng-if="!tls_config.enabled" data-translate>Enable</span>
      <span data-ng-if="tls_config.enabled" data-translate>Disable</span>
    </button>
  </div>
</div>
