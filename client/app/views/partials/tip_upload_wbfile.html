<div id="TipPageWBFileUpload" class="panel panel-default" data-ng-init="collapsed = false">
  <div class="panel-heading" data-ng-click="collapsed = !collapsed; $event.stopPropagation();">
    <div>
      <span data-translate>Attached files for the whistleblower</span>
      <span class="pull-right">
        <i data-ng-if="!collapsed" class="glyphicon glyphicon-collapse-down" uib-popover="{{'Collapse' | translate}}" popover-placement="left" popover-trigger="'mouseenter'"></i>
        <i data-ng-if="collapsed" class="glyphicon glyphicon-fullscreen" uib-popover="{{'Expand' | translate}}" popover-placement="left" popover-trigger="'mouseenter'"></i>
      </span>
    </div>
  </div>
  <div class="TipPageSectionContent panel-body" data-ng-show="!collapsed"
       data-ng-controller="RTipWBFileUploadCtrl">

    <div class="alert alert-warning">
      <i class="glyphicon glyphicon-warning-sign"></i>
      <strong><span data-translate>Warning</span></strong>
      <span data-translate>Files uploaded here are made available for the whistleblower and other recipients to download.</span>
    </div>

    <div data-ng-repeat="wbfile in tip.wbfiles | orderBy: 'creation_date'">
      <div class="wbfile panel panel-default">
        <div class="panel-body">
          <div class="top-row">
            <span class="filename pull-left">{{::wbfile.name }}</span>
            <span class="pull-right">
              <span class="btn btn-primary btn-xs" data-ng-click="downloadWBFile(wbfile)">
                <span class="glyphicon glyphicon-download"></span> <span data-translate>Download</span>
              </span>
              <span class="btn btn-danger btn-xs" data-ng-click="deleteWBFile(wbfile)">
                <span class="glyphicon glyphicon-trash"></span> <span data-translate>Delete</span>
              </span>
            </span>
          </div>
          <div class="clearfix"></div>
          <p class="file-info-row">
            <span>
              <span class="text-muted" data-translate>From</span>:&nbsp;
              <span>
              {{::wbfile.author | wbfileCreator: tip.receivers }}
              </span>
            </span>&nbsp;&nbsp;
            <span>
              <span class="text-muted" data-translate>Creation date</span>:&nbsp;
              <span >
              {{::wbfile.creation_date | date:'dd-MM-yyyy HH:MM'}}
              </span>
            </span>&nbsp;&nbsp;
            <span>
              <span class="text-muted" data-translate>Size</span>:&nbsp;
              <span>
              {{::wbfile.size | byteFmt:2}}
              </span>
            </span>
          </p>
          <p data-ng-if="wbfile.description !== ''">
            <span class="text-muted">
              <span data-translate>Description</span>:
            </span>&nbsp;
            {{::wbfile.description | limitTo:20 }}
          </p>
        </div>
      </div>

    </div>
    <h5>Upload a new file</h5>
    <span class="form-inline" data-ng-controller="WBFileUploadCtrl">
      <span class="form-group">
        <span class="input-group">
          <span class="input-group-addon">Description</span>
          <input type="text" class="form-control"
            data-ng-model="file_upload_description"
          />
          <span class="input-group-btn"
            flow-init="{target: 'rtip/' + tip_id + '/wbfile'}"
            flow-files-submitted="beginUpload($files, $event, $flow)"
            flow-error="throwErrUp($message)"
            flow-single-file
            flow-btn>
            <span class="btn btn-warning">
              <span class="glyphicon glyphicon-upload"></span>
              <span data-translate>Upload</span>
            </span>
          </span>
        </span>
      </span>
    </span>
  </div>
</div>
